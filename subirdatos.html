<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Subir JSON a Firebase Firestore</title>

    <!-- Cargar los SDK de Firebase sin módulos -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <h1>Subir JSON a Firestore</h1>

    <input type="file" id="jsonFileInput" accept=".json" />
    <button onclick="handleFileUpload()">Subir JSON</button>

    <script>
        // Configuración de Firebase (cambia los valores por los tuyos)
        const firebaseConfig = {
            apiKey: "AIzaSyDdjYoi4BSBFFAuXumLxj-NMQWUVSFdSv4",
            authDomain: "contratos-5e932.firebaseapp.com",
            projectId: "contratos-5e932",
            storageBucket: "contratos-5e932.firebasestorage.app",
            messagingSenderId: "945849105278",
            appId: "1:945849105278:web:f0291a411b8e33327a112f"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Función para manejar la carga del archivo
        function handleFileUpload() {
            const fileInput = document.getElementById('jsonFileInput');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();

                // Lee el archivo como JSON
                reader.onload = function(event) {
                    try {
                        // Convierte el contenido del archivo a un objeto JavaScript
                        const jsonData = JSON.parse(event.target.result);
                        // Llama a la función para subir los datos a Firestore
                        uploadJSONToFirestore(jsonData);
                    } catch (error) {
                        console.error("Error al procesar el archivo JSON:", error);
                    }
                };

                reader.readAsText(file); // Lee el archivo como texto
            } else {
                console.log("No se seleccionó un archivo");
            }
        }

        // Función para subir los datos del JSON a Firestore
        // Función para subir los datos del JSON a Firestore
        function uploadJSONToFirestore(jsonData) {
            if (Array.isArray(jsonData)) {
                let count = 0;  // Contador para los registros

                jsonData.forEach((item) => {
                    // Subir el item a la colección 'users'
                    db.collection("contratos").add(item)
                        .then((docRef) => {
                            console.log("Documento agregado con ID: ", docRef.id);
                            count++;  // Incrementar el contador por cada registro agregado
                        })
                        .catch((error) => {
                            console.error("Error al agregar el documento: ", error);
                        });
                });

                // Mostrar el número de registros agregados
                setTimeout(() => {
                    console.log("Se han agregado " + count + " registros.");
                }, 1000);  // Esperar un poco para asegurarse de que se completen las promesas
            } else {
                console.error("El archivo JSON no tiene la estructura correcta.");
            }
        }

    </script>
</body>
</html>
